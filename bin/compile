#!/usr/bin/env sh

set -x

ENV_DIR=${3:-}
env | sort
pwd
ls -l
ls -l $ENV_DIR/GIT_DEPLOY_KEY
echo >> $ENV_DIR/GIT_DEPLOY_KEY
ls -l $ENV_DIR/GIT_DEPLOY_KEY

mkdir -p ~/.ssh
chmod 700 ~/.ssh

cat <<EOI >~/.ssh/config
Host github.com
  IdentityFile $ENV_DIR/GIT_DEPLOY_KEY
  IdentitiesOnly yes
  UserKnownHostsFile=/dev/null
  StrictHostKeyChecking no
  LogLevel DEBUG3
EOI

# echo    "Host github.com\n"\
#         " IdentityFile $ENV_DIR/GIT_DEPLOY_KEY\n"\
#         " IdentitiesOnly yes\n"\
#         " UserKnownHostsFile=/dev/null\n"\
#         " StrictHostKeyChecking no"\
#         " LogLevel DEBUG3"\
#         > ~/.ssh/config

echo "=== ssh config"
cat ~/.ssh/config

# echo "=== ssh github"
# ssh -vvvvvvvvvvvvv git@github.com

echo "=== git ls-remote"
git ls-remote -h -t ssh://git@github.com/revupsw/emerge_nfp.git
