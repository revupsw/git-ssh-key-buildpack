#!/usr/bin/env sh

set -x

ENV_DIR=${3:-}
env | sort
pwd
ls -l
ls -l $ENV_DIR/GIT_DEPLOY_KEY

set -e

mkdir -p ~/.ssh
chmod 700 ~/.ssh

echo    "Host github.com\n"\
        " IdentityFile $ENV_DIR/GIT_DEPLOY_KEY\n"\
        " IdentitiesOnly yes\n"\
        " UserKnownHostsFile=/dev/null\n"\
        " StrictHostKeyChecking no"\
        > ~/.ssh/config

echo "=== ssh config"
cat ~/.ssh/config

echo "=== git ls-remote"
git ls-remote -h -t ssh://git@github.com/revupsw/emerge_nfp.git
